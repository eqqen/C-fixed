<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Шейный отдел — генератор формулировок v5.1</title>
  <style>
    :root{ --border:#e5e7eb; --bg:#fff; --bgm:#f9fafb; --text:#111827; --r:12px; }
    body{ font-family:"Trebuchet MS",Arial,sans-serif; color:var(--text); margin:12px; font-size:14px; line-height:1.45; }
    .controls{ display:flex; gap:8px; flex-wrap:wrap; margin:10px 0; }
    button{ padding:8px 12px; border:1px solid var(--border); border-radius:var(--r); background:#fff; cursor:pointer; }
    button:hover{ background:var(--bgm); }
    .table-wrap{ overflow-x:auto; -webkit-overflow-scrolling:touch; border:1px solid var(--border); border-radius:var(--r); }
    table{ border-collapse:collapse; min-width:980px; width:100%; }
    th,td{ border-bottom:1px solid var(--border); padding:8px; vertical-align:top; text-align:left; }
    th{ background:var(--bgm); }
    .checkcol{ display:flex; flex-direction:column; gap:6px; max-height:180px; overflow:auto; }
    .radiocol{ display:flex; flex-direction:column; gap:6px; max-height:180px; overflow:auto; }
    th.col1,td.col1{ width:160px; }
    th.col2,td.col2{ width:180px; }
    th.col5,td.col5{ width:200px; }
    .paragraphs{ border:1px dashed var(--border); border-radius:var(--r); padding:10px; margin-top:10px; background:#fff; }
    .para{ background:var(--bgm); border-radius:10px; padding:8px; margin:6px 0; }
  </style>
  <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
</head>
<body>
  <h3>Шейный отдел — генератор формулировок v5.1</h3>
  <div class="controls">
    <button id="addRow" type="button">+ Добавить строку</button>
    <button id="clearRows" type="button">Очистить</button>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th class="col1">Сегменты</th>
          <th class="col2">Вид</th>
          <th>Зоны/секторы</th>
          <th>Глубина, мм</th>
          <th class="col5">Фиброзное кольцо</th>
          <th>Миграция</th>
          <th>Дополнительно</th>
          <th>Действия</th>
        </tr>
      </thead>
      <tbody id="body"></tbody>
    </table>
  </div>

  <h4>Сформированные абзацы</h4>
  <div id="paragraphs" class="paragraphs"></div>

  <script>
    // ===== тут весь твой основной JS (LEVELS, TYPES, ZONES и т.д.) =====
    // Я его не менял — оставь как у тебя в v5

    // ... все функции buildParagraph, getRows и т.п. остаются как были ...

    function render(){
      const rows = getRows();
      const paragraphs = rows.map(buildParagraph);
      const wrap = document.getElementById("paragraphs");
      wrap.innerHTML = "";
      paragraphs.forEach(p=> wrap.insertAdjacentHTML("beforeend", p.html));
      const value = { rows, paragraphs, text: paragraphs.map(p=>p.text).join("\n\n") };
      if(window.JFCustomWidget){
        JFCustomWidget.sendData({ value: JSON.stringify(value) });
        if(JFCustomWidget.setHeight){
          const h = document.documentElement.scrollHeight || document.body.scrollHeight;
          JFCustomWidget.setHeight(h + 40);
        }
      }
    }

    // Автоматический пересчёт высоты при любых изменениях
    const resizeObs = new ResizeObserver(()=>{
      if(window.JFCustomWidget && JFCustomWidget.setHeight){
        const h = document.documentElement.scrollHeight || document.body.scrollHeight;
        JFCustomWidget.setHeight(h + 40);
      }
    });
    resizeObs.observe(document.body);

    // ... остальная инициализация (addRow, clearRows, JFCustomWidget.subscribe) без изменений ...
  </script>
</body>
</html>
